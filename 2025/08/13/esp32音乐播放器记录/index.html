<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ESP32-S3音乐播放器材料和三方库esp32-s3 wroom n16r8 cam ESP32S3-CAM高清大图 ESP32-S3-CAM引脚图 基于ESP32-S3-WROOM-N16R8模组，原设计为FREENOVE_esp32s3 cam 高清大图-CSDN博客 MAX98357A功放 123#define I2S_DOUT      9#define I2S_BCLK      10">
<meta property="og:type" content="article">
<meta property="og:title" content="esp32音乐播放器记录">
<meta property="og:url" content="http://example.com/2025/08/13/esp32%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="ESP32-S3音乐播放器材料和三方库esp32-s3 wroom n16r8 cam ESP32S3-CAM高清大图 ESP32-S3-CAM引脚图 基于ESP32-S3-WROOM-N16R8模组，原设计为FREENOVE_esp32s3 cam 高清大图-CSDN博客 MAX98357A功放 123#define I2S_DOUT      9#define I2S_BCLK      10">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-08-13T14:22:25.000Z">
<meta property="article:modified_time" content="2025-08-13T14:34:00.537Z">
<meta property="article:author" content="Kevin-100717">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2025/08/13/esp32%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E8%AE%B0%E5%BD%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>esp32音乐播放器记录 | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/13/esp32%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Kevin-100717">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          esp32音乐播放器记录
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-08-13 22:22:25 / Modified: 22:34:00" itemprop="dateCreated datePublished" datetime="2025-08-13T22:22:25+08:00">2025-08-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="ESP32-S3音乐播放器"><a href="#ESP32-S3音乐播放器" class="headerlink" title="ESP32-S3音乐播放器"></a>ESP32-S3音乐播放器</h1><h2 id="材料和三方库"><a href="#材料和三方库" class="headerlink" title="材料和三方库"></a>材料和三方库</h2><p>esp32-s3 wroom n16r8 cam</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qzlbr/article/details/148078393">ESP32S3-CAM高清大图 ESP32-S3-CAM引脚图 基于ESP32-S3-WROOM-N16R8模组，原设计为FREENOVE_esp32s3 cam 高清大图-CSDN博客</a></p>
<p>MAX98357A功放</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> I2S_DOUT      9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I2S_BCLK      10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I2S_LRC       11</span></span><br></pre></td></tr></table></figure>

<p>VIN-5V</p>
<p>GND-GND</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/FBsharl/p/18336848">ESP32 使用 MAX98357 播放MP3 - FBshark - 博客园</a></p>
<p>tft屏幕（st7789 2.0tftspi GMT020-02-8P VER1.21）</p>
<p>TFT_eSPI配置文件</p>
<p>User_Setup.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//                            USER DEFINED SETTINGS</span></span><br><span class="line"><span class="comment">//   Set driver type, fonts to be loaded, pins used and SPI control method etc.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   See the User_Setup_Select.h file if you wish to be able to define multiple</span></span><br><span class="line"><span class="comment">//   setups and then easily select which setup file is used by the compiler.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   If this file is edited correctly then all the library example sketches should</span></span><br><span class="line"><span class="comment">//   run without the need to make any more changes for a particular hardware setup!</span></span><br><span class="line"><span class="comment">//   Note that some sketches are designed for a particular TFT pixel width/height</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// User defined information reported by &quot;Read_User_Setup&quot; test &amp; diagnostics example</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> USER_SETUP_INFO <span class="string">&quot;User_Setup&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define to disable all #warnings in library (can be put in User_Setup_Select.h)</span></span><br><span class="line"><span class="comment">//#define DISABLE_ALL_LIBRARY_WARNINGS</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ##################################################################################</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Section 1. Call up the right driver file and any options for it</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// ##################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define STM32 to invoke optimised processor support (only for STM32)</span></span><br><span class="line"><span class="comment">//#define STM32</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Defining the STM32 board allows the library to optimise the performance</span></span><br><span class="line"><span class="comment">// for UNO compatible &quot;MCUfriend&quot; style shields</span></span><br><span class="line"><span class="comment">//#define NUCLEO_64_TFT</span></span><br><span class="line"><span class="comment">//#define NUCLEO_144_TFT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// STM32 8-bit parallel only:</span></span><br><span class="line"><span class="comment">// If STN32 Port A or B pins 0-7 are used for 8-bit parallel data bus bits 0-7</span></span><br><span class="line"><span class="comment">// then this will improve rendering performance by a factor of ~8x</span></span><br><span class="line"><span class="comment">//#define STM_PORTA_DATA_BUS</span></span><br><span class="line"><span class="comment">//#define STM_PORTB_DATA_BUS</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Tell the library to use parallel mode (otherwise SPI is assumed)</span></span><br><span class="line"><span class="comment">//#define TFT_PARALLEL_8_BIT</span></span><br><span class="line"><span class="comment">//#defined TFT_PARALLEL_16_BIT // **** 16-bit parallel ONLY for RP2040 processor ****</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Display type -  only define if RPi display</span></span><br><span class="line"><span class="comment">//#define RPI_DISPLAY_TYPE // 20MHz maximum SPI</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Only define one driver, the other ones must be commented out</span></span><br><span class="line"><span class="comment">// #define ILI9341_DRIVER       // Generic driver for common displays</span></span><br><span class="line"><span class="comment">//#define ILI9341_2_DRIVER     // Alternative ILI9341 driver, see https://github.com/Bodmer/TFT_eSPI/issues/1172</span></span><br><span class="line"><span class="comment">//#define ST7735_DRIVER      // Define additional parameters below for this display</span></span><br><span class="line"><span class="comment">//#define ILI9163_DRIVER     // Define additional parameters below for this display</span></span><br><span class="line"><span class="comment">//#define S6D02A1_DRIVER</span></span><br><span class="line"><span class="comment">//#define RPI_ILI9486_DRIVER // 20MHz maximum SPI</span></span><br><span class="line"><span class="comment">//#define HX8357D_DRIVER</span></span><br><span class="line"><span class="comment">//#define ILI9481_DRIVER</span></span><br><span class="line"><span class="comment">//#define ILI9486_DRIVER</span></span><br><span class="line"><span class="comment">//#define ILI9488_DRIVER     // WARNING: Do not connect ILI9488 display SDO to MISO if other devices share the SPI bus (TFT SDO does NOT tristate when CS is high)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ST7789_DRIVER      <span class="comment">// Full configuration option, define additional parameters below for this display</span></span></span><br><span class="line"><span class="comment">//#define ST7789_2_DRIVER    // Minimal configuration option, define additional parameters below for this display</span></span><br><span class="line"><span class="comment">//#define R61581_DRIVER</span></span><br><span class="line"><span class="comment">//#define RM68140_DRIVER</span></span><br><span class="line"><span class="comment">//#define ST7796_DRIVER</span></span><br><span class="line"><span class="comment">//#define SSD1351_DRIVER</span></span><br><span class="line"><span class="comment">//#define SSD1963_480_DRIVER</span></span><br><span class="line"><span class="comment">//#define SSD1963_800_DRIVER</span></span><br><span class="line"><span class="comment">//#define SSD1963_800ALT_DRIVER</span></span><br><span class="line"><span class="comment">//#define ILI9225_DRIVER</span></span><br><span class="line"><span class="comment">//#define GC9A01_DRIVER</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Some displays support SPI reads via the MISO pin, other displays have a single</span></span><br><span class="line"><span class="comment">// bi-directional SDA pin and the library will try to read this via the MOSI line.</span></span><br><span class="line"><span class="comment">// To use the SDA line for reading data from the TFT uncomment the following line:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define TFT_SDA_READ      // This option is for ESP32 ONLY, tested with ST7789 and GC9A01 display only</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For ST7735, ST7789 and ILI9341 ONLY, define the colour order IF the blue and red are swapped on your display</span></span><br><span class="line"><span class="comment">// Try ONE option at a time to find the correct colour order for your display</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  #define TFT_RGB_ORDER TFT_RGB  // Colour order Red-Green-Blue</span></span><br><span class="line"> <span class="meta">#<span class="keyword">define</span> TFT_RGB_ORDER TFT_BGR  <span class="comment">// Colour order Blue-Green-Red</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For M5Stack ESP32 module with integrated ILI9341 display ONLY, remove // in line below</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define M5STACK</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For ST7789, ST7735, ILI9163 and GC9A01 ONLY, define the pixel width and height in portrait orientation</span></span><br><span class="line"><span class="comment">// #define TFT_WIDTH  80</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TFT_WIDTH  240</span></span><br><span class="line"><span class="comment">// #define TFT_WIDTH  172 // ST7789 172 x 320</span></span><br><span class="line"><span class="comment">// #define TFT_WIDTH  170 // ST7789 170 x 320</span></span><br><span class="line"><span class="comment">// #define TFT_WIDTH  240 // ST7789 240 x 240 and 240 x 320</span></span><br><span class="line"><span class="comment">// #define TFT_HEIGHT 160</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TFT_HEIGHT 320</span></span><br><span class="line"><span class="comment">// #define TFT_HEIGHT 240 // ST7789 240 x 240</span></span><br><span class="line"><span class="comment">// #define TFT_HEIGHT 320 // ST7789 240 x 320</span></span><br><span class="line"><span class="comment">// #define TFT_HEIGHT 240 // GC9A01 240 x 240</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For ST7735 ONLY, define the type of display, originally this was based on the</span></span><br><span class="line"><span class="comment">// colour of the tab on the screen protector film but this is not always true, so try</span></span><br><span class="line"><span class="comment">// out the different options below if the screen does not display graphics correctly,</span></span><br><span class="line"><span class="comment">// e.g. colours wrong, mirror images, or stray pixels at the edges.</span></span><br><span class="line"><span class="comment">// Comment out ALL BUT ONE of these options for a ST7735 display driver, save this</span></span><br><span class="line"><span class="comment">// this User_Setup file, then rebuild and upload the sketch to the board again:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define ST7735_INITB</span></span><br><span class="line"><span class="comment">// #define ST7735_GREENTAB</span></span><br><span class="line"><span class="comment">// #define ST7735_GREENTAB2</span></span><br><span class="line"><span class="comment">// #define ST7735_GREENTAB3</span></span><br><span class="line"><span class="comment">// #define ST7735_GREENTAB128    // For 128 x 128 display</span></span><br><span class="line"><span class="comment">// #define ST7735_GREENTAB160x80 // For 160 x 80 display (BGR, inverted, 26 offset)</span></span><br><span class="line"><span class="comment">// #define ST7735_ROBOTLCD       // For some RobotLCD Arduino shields (128x160, BGR, https://docs.arduino.cc/retired/getting-started-guides/TFT)</span></span><br><span class="line"><span class="comment">// #define ST7735_REDTAB</span></span><br><span class="line"><span class="comment">// #define ST7735_BLACKTAB</span></span><br><span class="line"><span class="comment">// #define ST7735_REDTAB160x80   // For 160 x 80 display with 24 pixel offset</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// If colours are inverted (white shows as black) then uncomment one of the next</span></span><br><span class="line"><span class="comment">// 2 lines try both options, one of the options should correct the inversion.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define TFT_INVERSION_ON</span></span><br><span class="line"><span class="comment">// #define TFT_INVERSION_OFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ##################################################################################</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Section 2. Define the pins that are used to interface with the display here</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// ##################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// If a backlight control signal is available then define the TFT_BL pin in Section 2</span></span><br><span class="line"><span class="comment">// below. The backlight will be turned ON when tft.begin() is called, but the library</span></span><br><span class="line"><span class="comment">// needs to know if the LEDs are ON with the pin HIGH or LOW. If the LEDs are to be</span></span><br><span class="line"><span class="comment">// driven with a PWM signal or turned OFF/ON then this must be handled by the user</span></span><br><span class="line"><span class="comment">// sketch. e.g. with digitalWrite(TFT_BL, LOW);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define TFT_BL   32            // LED back-light control pin</span></span><br><span class="line"><span class="comment">// #define TFT_BACKLIGHT_ON HIGH  // Level to turn ON back-light (HIGH or LOW)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// We must use hardware SPI, a minimum of 3 GPIO pins is needed.</span></span><br><span class="line"><span class="comment">// Typical setup for ESP8266 NodeMCU ESP-12 is :</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Display SDO/MISO  to NodeMCU pin D6 (or leave disconnected if not reading TFT)</span></span><br><span class="line"><span class="comment">// Display LED       to NodeMCU pin VIN (or 5V, see below)</span></span><br><span class="line"><span class="comment">// Display SCK       to NodeMCU pin D5</span></span><br><span class="line"><span class="comment">// Display SDI/MOSI  to NodeMCU pin D7</span></span><br><span class="line"><span class="comment">// Display DC (RS/AO)to NodeMCU pin D3</span></span><br><span class="line"><span class="comment">// Display RESET     to NodeMCU pin D4 (or RST, see below)</span></span><br><span class="line"><span class="comment">// Display CS        to NodeMCU pin D8 (or GND, see below)</span></span><br><span class="line"><span class="comment">// Display GND       to NodeMCU pin GND (0V)</span></span><br><span class="line"><span class="comment">// Display VCC       to NodeMCU 5V or 3.3V</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The TFT RESET pin can be connected to the NodeMCU RST pin or 3.3V to free up a control pin</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The DC (Data Command) pin may be labelled AO or RS (Register Select)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// With some displays such as the ILI9341 the TFT CS pin can be connected to GND if no more</span></span><br><span class="line"><span class="comment">// SPI devices (e.g. an SD Card) are connected, in this case comment out the #define TFT_CS</span></span><br><span class="line"><span class="comment">// line below so it is NOT defined. Other displays such at the ST7735 require the TFT CS pin</span></span><br><span class="line"><span class="comment">// to be toggled during setup, so in these cases the TFT_CS line must be defined and connected.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The NodeMCU D0 pin can be used for RST</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Note: only some versions of the NodeMCU provide the USB 5V on the VIN pin</span></span><br><span class="line"><span class="comment">// If 5V is not available at a pin you can use 3.3V but backlight brightness</span></span><br><span class="line"><span class="comment">// will be lower.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ###### EDIT THE PIN NUMBERS IN THE LINES FOLLOWING TO SUIT YOUR ESP8266 SETUP ######</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For NodeMCU - use pin numbers in the form PIN_Dx where Dx is the NodeMCU pin designation</span></span><br><span class="line"><span class="comment">// #define TFT_MISO  PIN_D6  // Automatically assigned with ESP8266 if not defined</span></span><br><span class="line"><span class="comment">// #define TFT_MOSI  PIN_D7  // Automatically assigned with ESP8266 if not defined</span></span><br><span class="line"><span class="comment">// #define TFT_SCLK  PIN_D5  // Automatically assigned with ESP8266 if not defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define TFT_CS    0  // Chip select control pin D8</span></span><br><span class="line"><span class="comment">// #define TFT_DC    5  // Data Command control pin</span></span><br><span class="line"><span class="comment">// #define TFT_RST   4  // Reset pin (could connect to NodeMCU RST, see next line)</span></span><br><span class="line"><span class="comment">//#define TFT_RST  -1     // Set TFT_RST to -1 if the display RESET is connected to NodeMCU RST or 3.3V</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_BL PIN_D1  // LED back-light (only for ST7789 with backlight control pin)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TOUCH_CS PIN_D2     // Chip select pin (T_CS) of touch screen</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_WR PIN_D2       // Write strobe for modified Raspberry Pi TFT only</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ######  FOR ESP8266 OVERLAP MODE EDIT THE PIN NUMBERS IN THE FOLLOWING LINES  ######</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Overlap mode shares the ESP8266 FLASH SPI bus with the TFT so has a performance impact</span></span><br><span class="line"><span class="comment">// but saves pins for other functions. It is best not to connect MISO as some displays</span></span><br><span class="line"><span class="comment">// do not tristate that line when chip select is high!</span></span><br><span class="line"><span class="comment">// Note: Only one SPI device can share the FLASH SPI lines, so a SPI touch controller</span></span><br><span class="line"><span class="comment">// cannot be connected as well to the same SPI signals.</span></span><br><span class="line"><span class="comment">// On NodeMCU 1.0 SD0=MISO, SD1=MOSI, CLK=SCLK to connect to TFT in overlap mode</span></span><br><span class="line"><span class="comment">// On NodeMCU V3  S0 =MISO, S1 =MOSI, S2 =SCLK</span></span><br><span class="line"><span class="comment">// In ESP8266 overlap mode the following must be defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_SPI_OVERLAP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In ESP8266 overlap mode the TFT chip select MUST connect to pin D3</span></span><br><span class="line"><span class="comment">//#define TFT_CS   PIN_D3</span></span><br><span class="line"><span class="comment">//#define TFT_DC   PIN_D5  // Data Command control pin</span></span><br><span class="line"><span class="comment">//#define TFT_RST  PIN_D4  // Reset pin (could connect to NodeMCU RST, see next line)</span></span><br><span class="line"><span class="comment">//#define TFT_RST  -1  // Set TFT_RST to -1 if the display RESET is connected to NodeMCU RST or 3.3V</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ###### EDIT THE PIN NUMBERS IN THE LINES FOLLOWING TO SUIT YOUR ESP32 SETUP   ######</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For ESP32 Dev board (only tested with ILI9341 display)</span></span><br><span class="line"><span class="comment">// The hardware SPI can be mapped to any pins</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_MISO </span></span><br><span class="line"><span class="comment">//#define TFT_MOSI 23</span></span><br><span class="line"><span class="comment">//#define TFT_SCLK 18</span></span><br><span class="line"><span class="comment">//#define TFT_CS   15  // Chip select control pin</span></span><br><span class="line"><span class="comment">//#define TFT_DC    2  // Data Command control pin</span></span><br><span class="line"><span class="comment">//#define TFT_RST   4  // Reset pin (could connect to RST pin)</span></span><br><span class="line"><span class="comment">//#define TFT_RST  -1  // Set TFT_RST to -1 if display RESET is connected to ESP32 board RST</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For ESP32 Dev board (only tested with GC9A01 display)</span></span><br><span class="line"><span class="comment">// The hardware SPI can be mapped to any pins</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TFT_MOSI 12 <span class="comment">// In some display driver board, it might be written as &quot;SDA&quot; and so on.</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TFT_SCLK 13 <span class="comment">//SCL</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TFT_CS   17  <span class="comment">// Chip select control pin CS</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TFT_DC   16  <span class="comment">// Data Command control pin DC</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TFT_RST  15  <span class="comment">// Reset pin (could connect to RST Arduino RESET pin)</span></span></span><br><span class="line"><span class="comment">//BLK -&gt; 3v3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TOUCH_CS 21     // Chip select pin (T_CS) of touch screen</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_WR 22    // Write strobe for modified Raspberry Pi TFT only</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For the M5Stack module use these #define lines</span></span><br><span class="line"><span class="comment">//#define TFT_MISO 19</span></span><br><span class="line"><span class="comment">//#define TFT_MOSI 23</span></span><br><span class="line"><span class="comment">//#define TFT_SCLK 18</span></span><br><span class="line"><span class="comment">//#define TFT_CS   14  // Chip select control pin</span></span><br><span class="line"><span class="comment">//#define TFT_DC   27  // Data Command control pin</span></span><br><span class="line"><span class="comment">//#define TFT_RST  33  // Reset pin (could connect to Arduino RESET pin)</span></span><br><span class="line"><span class="comment">//#define TFT_BL   32  // LED back-light (required for M5Stack)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ######       EDIT THE PINs BELOW TO SUIT YOUR ESP32 PARALLEL TFT SETUP        ######</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The library supports 8-bit parallel TFTs with the ESP32, the pin</span></span><br><span class="line"><span class="comment">// selection below is compatible with ESP32 boards in UNO format.</span></span><br><span class="line"><span class="comment">// Wemos D32 boards need to be modified, see diagram in Tools folder.</span></span><br><span class="line"><span class="comment">// Only ILI9481 and ILI9341 based displays have been tested!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Parallel bus is only supported for the STM32 and ESP32</span></span><br><span class="line"><span class="comment">// Example below is for ESP32 Parallel interface with UNO displays</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Tell the library to use 8-bit parallel mode (otherwise SPI is assumed)</span></span><br><span class="line"><span class="comment">//#define TFT_PARALLEL_8_BIT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The ESP32 and TFT the pins used for testing are:</span></span><br><span class="line"><span class="comment">//#define TFT_CS   33  // Chip select control pin (library pulls permanently low</span></span><br><span class="line"><span class="comment">//#define TFT_DC   15  // Data Command control pin - must use a pin in the range 0-31</span></span><br><span class="line"><span class="comment">//#define TFT_RST  32  // Reset pin, toggles on startup</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_WR    4  // Write strobe control pin - must use a pin in the range 0-31</span></span><br><span class="line"><span class="comment">//#define TFT_RD    2  // Read strobe control pin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_D0   12  // Must use pins in the range 0-31 for the data bus</span></span><br><span class="line"><span class="comment">//#define TFT_D1   13  // so a single register write sets/clears all bits.</span></span><br><span class="line"><span class="comment">//#define TFT_D2   26  // Pins can be randomly assigned, this does not affect</span></span><br><span class="line"><span class="comment">//#define TFT_D3   25  // TFT screen update performance.</span></span><br><span class="line"><span class="comment">//#define TFT_D4   17</span></span><br><span class="line"><span class="comment">//#define TFT_D5   16</span></span><br><span class="line"><span class="comment">//#define TFT_D6   27</span></span><br><span class="line"><span class="comment">//#define TFT_D7   14</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ######       EDIT THE PINs BELOW TO SUIT YOUR STM32 SPI TFT SETUP        ######</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The TFT can be connected to SPI port 1 or 2</span></span><br><span class="line"><span class="comment">//#define TFT_SPI_PORT 1 // SPI port 1 maximum clock rate is 55MHz</span></span><br><span class="line"><span class="comment">//#define TFT_MOSI PA7</span></span><br><span class="line"><span class="comment">//#define TFT_MISO PA6</span></span><br><span class="line"><span class="comment">//#define TFT_SCLK PA5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_SPI_PORT 2 // SPI port 2 maximum clock rate is 27MHz</span></span><br><span class="line"><span class="comment">//#define TFT_MOSI PB15</span></span><br><span class="line"><span class="comment">//#define TFT_MISO PB14</span></span><br><span class="line"><span class="comment">//#define TFT_SCLK PB13</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Can use Ardiuno pin references, arbitrary allocation, TFT_eSPI controls chip select</span></span><br><span class="line"><span class="comment">//#define TFT_CS   D5 // Chip select control pin to TFT CS</span></span><br><span class="line"><span class="comment">//#define TFT_DC   D6 // Data Command control pin to TFT DC (may be labelled RS = Register Select)</span></span><br><span class="line"><span class="comment">//#define TFT_RST  D7 // Reset pin to TFT RST (or RESET)</span></span><br><span class="line"><span class="comment">// OR alternatively, we can use STM32 port reference names PXnn</span></span><br><span class="line"><span class="comment">//#define TFT_CS   PE11 // Nucleo-F767ZI equivalent of D5</span></span><br><span class="line"><span class="comment">//#define TFT_DC   PE9  // Nucleo-F767ZI equivalent of D6</span></span><br><span class="line"><span class="comment">//#define TFT_RST  PF13 // Nucleo-F767ZI equivalent of D7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define TFT_RST  -1   // Set TFT_RST to -1 if the display RESET is connected to processor reset</span></span><br><span class="line">                        <span class="comment">// Use an Arduino pin for initial testing as connecting to processor reset</span></span><br><span class="line">                        <span class="comment">// may not work (pulse too short at power up?)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ##################################################################################</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Section 3. Define the fonts that are to be used here</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// ##################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Comment out the #defines below with // to stop that font being loaded</span></span><br><span class="line"><span class="comment">// The ESP8366 and ESP32 have plenty of memory so commenting out fonts is not</span></span><br><span class="line"><span class="comment">// normally necessary. If all fonts are loaded the extra FLASH space required is</span></span><br><span class="line"><span class="comment">// about 17Kbytes. To save FLASH space only enable the fonts you need!</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD_GLCD   <span class="comment">// Font 1. Original Adafruit 8 pixel font needs ~1820 bytes in FLASH</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD_FONT2  <span class="comment">// Font 2. Small 16 pixel high font, needs ~3534 bytes in FLASH, 96 characters</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD_FONT4  <span class="comment">// Font 4. Medium 26 pixel high font, needs ~5848 bytes in FLASH, 96 characters</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD_FONT6  <span class="comment">// Font 6. Large 48 pixel font, needs ~2666 bytes in FLASH, only characters 1234567890:-.apm</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD_FONT7  <span class="comment">// Font 7. 7 segment 48 pixel font, needs ~2438 bytes in FLASH, only characters 1234567890:-.</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD_FONT8  <span class="comment">// Font 8. Large 75 pixel font needs ~3256 bytes in FLASH, only characters 1234567890:-.</span></span></span><br><span class="line"><span class="comment">//#define LOAD_FONT8N // Font 8. Alternative to Font 8 above, slightly narrower, so 3 digits fit a 160 pixel TFT</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD_GFXFF  <span class="comment">// FreeFonts. Include access to the 48 Adafruit_GFX free fonts FF1 to FF48 and custom fonts</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Comment out the #define below to stop the SPIFFS filing system and smooth font code being loaded</span></span><br><span class="line"><span class="comment">// this will save ~20kbytes of FLASH</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SMOOTH_FONT</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ##################################################################################</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Section 4. Other options</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// ##################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For RP2040 processor and SPI displays, uncomment the following line to use the PIO interface.</span></span><br><span class="line"><span class="comment">//#define RP2040_PIO_SPI // Leave commented out to use standard RP2040 SPI port interface</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For RP2040 processor and 8 or 16-bit parallel displays:</span></span><br><span class="line"><span class="comment">// The parallel interface write cycle period is derived from a division of the CPU clock</span></span><br><span class="line"><span class="comment">// speed so scales with the processor clock. This means that the divider ratio may need</span></span><br><span class="line"><span class="comment">// to be increased when overclocking. It may also need to be adjusted dependant on the</span></span><br><span class="line"><span class="comment">// display controller type (ILI94341, HX8357C etc.). If RP2040_PIO_CLK_DIV is not defined</span></span><br><span class="line"><span class="comment">// the library will set default values which may not suit your display.</span></span><br><span class="line"><span class="comment">// The display controller data sheet will specify the minimum write cycle period. The</span></span><br><span class="line"><span class="comment">// controllers often work reliably for shorter periods, however if the period is too short</span></span><br><span class="line"><span class="comment">// the display may not initialise or graphics will become corrupted.</span></span><br><span class="line"><span class="comment">// PIO write cycle frequency = (CPU clock/(4 * RP2040_PIO_CLK_DIV))</span></span><br><span class="line"><span class="comment">//#define RP2040_PIO_CLK_DIV 1 // 32ns write cycle at 125MHz CPU clock</span></span><br><span class="line"><span class="comment">//#define RP2040_PIO_CLK_DIV 2 // 64ns write cycle at 125MHz CPU clock</span></span><br><span class="line"><span class="comment">//#define RP2040_PIO_CLK_DIV 3 // 96ns write cycle at 125MHz CPU clock</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For the RP2040 processor define the SPI port channel used (default 0 if undefined)</span></span><br><span class="line"><span class="comment">//#define TFT_SPI_PORT 1 // Set to 0 if SPI0 pins are used, or 1 if spi1 pins used</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// For the STM32 processor define the SPI port channel used (default 1 if undefined)</span></span><br><span class="line"><span class="comment">//#define TFT_SPI_PORT 2 // Set to 1 for SPI port 1, or 2 for SPI port 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the SPI clock frequency, this affects the graphics rendering speed. Too</span></span><br><span class="line"><span class="comment">// fast and the TFT driver will not keep up and display corruption appears.</span></span><br><span class="line"><span class="comment">// With an ILI9341 display 40MHz works OK, 80MHz sometimes fails</span></span><br><span class="line"><span class="comment">// With a ST7735 display more than 27MHz may not work (spurious pixels and lines)</span></span><br><span class="line"><span class="comment">// With an ILI9163 display 27 MHz works OK.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define SPI_FREQUENCY   1000000</span></span><br><span class="line"><span class="comment">// #define SPI_FREQUENCY   5000000</span></span><br><span class="line"><span class="comment">// #define SPI_FREQUENCY  10000000</span></span><br><span class="line"><span class="comment">// #define SPI_FREQUENCY  20000000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI_FREQUENCY  27000000</span></span><br><span class="line"><span class="comment">// #define SPI_FREQUENCY  40000000</span></span><br><span class="line"><span class="comment">// #define SPI_FREQUENCY  55000000 // STM32 SPI1 only (SPI2 maximum is 27MHz)</span></span><br><span class="line"><span class="comment">// #define SPI_FREQUENCY  80000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Optional reduced SPI frequency for reading TFT</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI_READ_FREQUENCY  20000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The XPT2046 requires a lower SPI clock rate of 2.5MHz so we define that here:</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI_TOUCH_FREQUENCY  2500000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The ESP32 has 2 free SPI ports i.e. VSPI and HSPI, the VSPI is the default.</span></span><br><span class="line"><span class="comment">// If the VSPI port is in use and pins are not accessible (e.g. TTGO T-Beam)</span></span><br><span class="line"><span class="comment">// then uncomment the following line:</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> USE_HSPI_PORT</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Comment out the following #define if &quot;SPI Transactions&quot; do not need to be</span></span><br><span class="line"><span class="comment">// supported. When commented out the code size will be smaller and sketches will</span></span><br><span class="line"><span class="comment">// run slightly faster, so leave it commented out unless you need it!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Transaction support is needed to work with SD library but not needed with TFT_SdFat</span></span><br><span class="line"><span class="comment">// Transaction support is required if other SPI devices are connected.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Transactions are automatically enabled by the library for an ESP32 (to use HAL mutex)</span></span><br><span class="line"><span class="comment">// so changing it here has no effect</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define SUPPORT_TRANSACTIONS</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>按钮x3</p>
<p>一段接GND</p>
<p>另一端分布接入</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> pin_aud_up = <span class="number">3</span>;</span><br><span class="line"><span class="type">int</span> pin_aud_down = <span class="number">4</span>;</span><br><span class="line"><span class="type">int</span> pin_pause = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h2 id="后端简单处理"><a href="#后端简单处理" class="headerlink" title="后端简单处理"></a>后端简单处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os,requests</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">ind = <span class="number">0</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/songPic&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_local_resource</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;image.jpg&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> fw:</span><br><span class="line">        fw.write(requests.get(request.args.get(<span class="string">&quot;url&quot;</span>)).content)</span><br><span class="line">    Image.<span class="built_in">open</span>(<span class="string">&quot;image.jpg&quot;</span>).resize((<span class="number">140</span>,<span class="number">140</span>),Image.Resampling.BICUBIC).convert(<span class="string">&#x27;RGB&#x27;</span>).save(<span class="string">&quot;image.jpg&quot;</span>)</span><br><span class="line">    basedir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line">    file_path = os.path.join(basedir, <span class="string">&quot;image.jpg&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> send_file(file_path)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/songDetail&quot;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getDetail</span>():</span><br><span class="line">    <span class="keyword">global</span> ind</span><br><span class="line">    offset = <span class="number">4</span></span><br><span class="line">    ind+=<span class="number">1</span>;</span><br><span class="line">    sid = request.args.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    response = requests.get(<span class="string">&quot;http://localhost:3000/song/detail?ids=&quot;</span>+<span class="built_in">str</span>(sid)).json()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;static/music&quot;</span>+<span class="built_in">str</span>(ind)+<span class="string">&quot;.mp3&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> fw:</span><br><span class="line">        fw.write(requests.get(requests.get(<span class="string">&quot;http://localhost:3000/song/url?id=&quot;</span>+sid).json()[<span class="string">&quot;data&quot;</span>][<span class="number">0</span>][<span class="string">&quot;url&quot;</span>]).content)</span><br><span class="line">    lrc = requests.get(<span class="string">&quot;http://localhost:3000/lyric/new?id=&quot;</span>+<span class="built_in">str</span>(sid)).json()</span><br><span class="line">    <span class="built_in">print</span>(lrc[<span class="string">&quot;lrc&quot;</span>][<span class="string">&quot;lyric&quot;</span>].split(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        txt = [&#123;</span><br><span class="line">            <span class="string">&quot;t&quot;</span>:<span class="built_in">int</span>(x.split(<span class="string">&quot;[&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;]&quot;</span>)[<span class="number">0</span>].split(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>])*<span class="number">60</span>+<span class="built_in">int</span>(x.split(<span class="string">&quot;[&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;]&quot;</span>)[<span class="number">0</span>].split(<span class="string">&quot;:&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>])+offset <span class="keyword">if</span> <span class="keyword">not</span> x[<span class="number">0</span>]==<span class="string">&quot;&#123;&quot;</span> <span class="keyword">else</span> <span class="built_in">round</span>(json.loads(x)[<span class="string">&quot;t&quot;</span>]/<span class="number">1000</span>)+offset,</span><br><span class="line">            <span class="string">&quot;lrc&quot;</span>:x.split(<span class="string">&quot;]&quot;</span>)[<span class="number">1</span>] <span class="keyword">if</span> <span class="keyword">not</span> x[<span class="number">0</span>]==<span class="string">&quot;&#123;&quot;</span> <span class="keyword">else</span> <span class="string">&quot; &quot;</span>.join([y[<span class="string">&quot;tx&quot;</span>] <span class="keyword">for</span> y <span class="keyword">in</span> json.loads(x)[<span class="string">&quot;c&quot;</span>]])</span><br><span class="line">        &#125; <span class="keyword">for</span> x <span class="keyword">in</span> lrc[<span class="string">&quot;lrc&quot;</span>][<span class="string">&quot;lyric&quot;</span>].split(<span class="string">&quot;\n&quot;</span>)[<span class="number">0</span>:<span class="built_in">len</span>(lrc[<span class="string">&quot;lrc&quot;</span>][<span class="string">&quot;lyric&quot;</span>].split(<span class="string">&quot;\n&quot;</span>))-<span class="number">1</span>]]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        txt = [&#123;<span class="string">&quot;t&quot;</span>:<span class="number">0</span>,<span class="string">&quot;lrc&quot;</span>:<span class="string">&quot;纯音乐，请欣赏&quot;</span>&#125;]</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>:response[<span class="string">&quot;songs&quot;</span>][<span class="number">0</span>][<span class="string">&quot;name&quot;</span>],</span><br><span class="line">        <span class="string">&quot;pic&quot;</span>:<span class="string">&quot;http://192.168.2.3:3000/songPic?url=&quot;</span>+response[<span class="string">&quot;songs&quot;</span>][<span class="number">0</span>][<span class="string">&quot;al&quot;</span>][<span class="string">&quot;picUrl&quot;</span>],</span><br><span class="line">        <span class="string">&quot;ar&quot;</span>:<span class="string">&quot; &quot;</span>.join([x[<span class="string">&quot;name&quot;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> response[<span class="string">&quot;songs&quot;</span>][<span class="number">0</span>][<span class="string">&quot;ar&quot;</span>]]),</span><br><span class="line">        <span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://192.168.2.3:3000/static/music&quot;</span>+<span class="built_in">str</span>(ind)+<span class="string">&quot;.mp3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;dt&quot;</span>:<span class="built_in">round</span>(response[<span class="string">&quot;songs&quot;</span>][<span class="number">0</span>][<span class="string">&quot;dt&quot;</span>]/<span class="number">1000</span>),</span><br><span class="line">        <span class="string">&quot;lrc&quot;</span>:txt</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/song&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSong</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;url.txt&quot;</span>,<span class="string">&quot;r&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>).read().split(<span class="string">&quot;id=&quot;</span>)[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    [os.remove(<span class="string">&quot;static/&quot;</span>+x) <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir(<span class="string">&quot;static&quot;</span>)]</span><br><span class="line">    app.run(host=<span class="string">&quot;192.168.2.3&quot;</span>,port=<span class="number">3000</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx NeteaseCloudMusicApi@latest</span><br></pre></td></tr></table></figure>

<h2 id="硬件端"><a href="#硬件端" class="headerlink" title="硬件端"></a>硬件端</h2><h3 id="字体文件"><a href="#字体文件" class="headerlink" title="字体文件"></a>字体文件</h3><p><a target="_blank" rel="noopener" href="https://tool.chinaz.com/tools/unicode.aspx">Unicode编码转换 - 站长工具</a></p>
<p>esp32和8266通用</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/guguda1111/article/details/124181168">ESP8266之TFT_eSPI库的自定义字体_esp8266 字库-CSDN博客</a></p>
<p>gb2312字库</p>
<p><a target="_blank" rel="noopener" href="https://github.com/StarCompute/GB2312Font/blob/main/gb2312%E5%AD%97%E7%AC%A6%E9%9B%86.txt">GB2312Font&#x2F;gb2312字符集.txt at main · StarCompute&#x2F;GB2312Font</a></p>
<h3 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h3><p>字体文件导出为h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SPI.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TFT_eSPI.h&gt;</span> <span class="comment">// Hardware-specific library</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiMulti.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;siyuan16.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;HTTPClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SPIFFS.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;TJpg_Decoder.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Audio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">String ssid =     <span class="string">&quot;HUAWEI-91BH4L3&quot;</span>;</span><br><span class="line">String password = <span class="string">&quot;6C06D6B32227&quot;</span>;</span><br><span class="line"></span><br><span class="line">TFT_eSPI tft = <span class="built_in">TFT_eSPI</span>();</span><br><span class="line">TFT_eSprite sprite = <span class="built_in">TFT_eSprite</span>(&amp;tft);</span><br><span class="line">WiFiMulti wifiMulti;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I2S_DOUT      9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I2S_BCLK      10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I2S_LRC       11</span></span><br><span class="line">Audio audio;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> totalTime;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> pin_aud_up = <span class="number">3</span>;</span><br><span class="line"><span class="type">int</span> pin_aud_down = <span class="number">4</span>;</span><br><span class="line"><span class="type">int</span> pin_pause = <span class="number">5</span>;</span><br><span class="line"><span class="type">bool</span> isPlaying = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LrcInfo</span></span><br><span class="line">&#123;</span><br><span class="line">  String lrc;</span><br><span class="line">  <span class="type">int</span> t;</span><br><span class="line">&#125;;</span><br><span class="line">LrcInfo lrcs[<span class="number">1000</span>];</span><br><span class="line"><span class="type">int</span> lrcLen;</span><br><span class="line"><span class="type">int</span> nowIndex = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> audioVol = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">  <span class="built_in">pinMode</span>(pin_aud_up,INPUT_PULLUP);</span><br><span class="line">  <span class="built_in">pinMode</span>(pin_aud_down,INPUT_PULLUP);</span><br><span class="line">  <span class="built_in">pinMode</span>(pin_pause,INPUT_PULLUP);</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;Start&quot;</span>);</span><br><span class="line">  tft.<span class="built_in">init</span>();</span><br><span class="line">  tft.<span class="built_in">setRotation</span>(<span class="number">0</span>);</span><br><span class="line">  tft.<span class="built_in">fillScreen</span>(TFT_BLACK);</span><br><span class="line">  <span class="keyword">if</span> (!SPIFFS.<span class="built_in">begin</span>(<span class="literal">false</span>))</span><br><span class="line">  &#123;</span><br><span class="line">  	<span class="comment">// 初始化失败时处理</span></span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;SPIFFS-An error occurred while mounting SPIFFS&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 格式化SPIFFS分区</span></span><br><span class="line">    <span class="keyword">if</span> (SPIFFS.format())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 格式化成功</span></span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;SPIFFS partition formatted successfully&quot;</span>);</span><br><span class="line">      <span class="comment">// 重启</span></span><br><span class="line">      ESP.<span class="built_in">restart</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;SPIFFS partition format failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;SPIFFS init ok&quot;</span>);</span><br><span class="line">  WiFi.<span class="built_in">mode</span>(WIFI_STA);</span><br><span class="line">  wifiMulti.<span class="built_in">addAP</span>(ssid.<span class="built_in">c_str</span>(), password.<span class="built_in">c_str</span>());</span><br><span class="line">  wifiMulti.<span class="built_in">run</span>();</span><br><span class="line">  tft.<span class="built_in">loadFont</span>(siyuan16);</span><br><span class="line">  tft.<span class="built_in">setCursor</span>(<span class="number">10</span>,<span class="number">10</span>);</span><br><span class="line">  tft.<span class="built_in">println</span>(<span class="string">&quot;正在连接WiFi&quot;</span>);</span><br><span class="line">  tft.<span class="built_in">setSwapBytes</span>(<span class="literal">true</span>);</span><br><span class="line">  TJpgDec.<span class="built_in">setJpgScale</span>(<span class="number">1</span>);</span><br><span class="line">  TJpgDec.<span class="built_in">setCallback</span>(tft_output);</span><br><span class="line">  String dot = <span class="string">&quot;.&quot;</span>;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;Connecting to Wifi&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(WiFi.<span class="built_in">status</span>() != WL_CONNECTED)&#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;Connecting...&quot;</span>);</span><br><span class="line">      tft.<span class="built_in">fillScreen</span>(TFT_BLACK);</span><br><span class="line">      tft.<span class="built_in">setCursor</span>(<span class="number">10</span>,<span class="number">10</span>);</span><br><span class="line">      tft.<span class="built_in">println</span>(<span class="string">&quot;正在连接WiFi&quot;</span>);</span><br><span class="line">      tft.<span class="built_in">setCursor</span>(<span class="number">10</span>,<span class="number">40</span>);</span><br><span class="line">      tft.<span class="built_in">println</span>(dot);</span><br><span class="line">      dot += <span class="string">&quot;.&quot;</span>;</span><br><span class="line">      <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;Connected&quot;</span>);</span><br><span class="line">  tft.<span class="built_in">fillScreen</span>(TFT_BLACK);</span><br><span class="line">  tft.<span class="built_in">setCursor</span>(<span class="number">10</span>,<span class="number">10</span>);</span><br><span class="line">  tft.<span class="built_in">println</span>(<span class="string">&quot;正在连接WiFi&quot;</span>);</span><br><span class="line">  tft.<span class="built_in">setCursor</span>(<span class="number">10</span>,<span class="number">40</span>);</span><br><span class="line">  tft.<span class="built_in">println</span>(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">  audio.<span class="built_in">setPinout</span>(I2S_BCLK, I2S_LRC, I2S_DOUT);</span><br><span class="line">  audio.<span class="built_in">setVolume</span>(audioVol); <span class="comment">// 0...21</span></span><br><span class="line">  tft.<span class="built_in">fillScreen</span>(TFT_BLACK);</span><br><span class="line">  sprite.<span class="built_in">createSprite</span>(<span class="number">240</span>,<span class="number">100</span>);</span><br><span class="line">  sprite.<span class="built_in">loadFont</span>(siyuan16);</span><br><span class="line">  HTTPClient mic;</span><br><span class="line">  mic.<span class="built_in">begin</span>(<span class="string">&quot;http://192.168.2.3:3000/song&quot;</span>);</span><br><span class="line">  <span class="type">int</span> httpCode = mic.<span class="built_in">GET</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查返回码</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">      String sid = mic.<span class="built_in">getString</span>();</span><br><span class="line">      <span class="built_in">PlayMusic</span>(sid);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">      ESP.<span class="built_in">restart</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">    ESP.<span class="built_in">restart</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PlayMusic</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;Play music -&gt; id = &quot;</span>+id);</span><br><span class="line">  HTTPClient http;</span><br><span class="line">  http.<span class="built_in">begin</span>(<span class="string">&quot;http://192.168.2.3:3000/songDetail?id=&quot;</span>+id); <span class="comment">// 服务器地址</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发送 HTTP GET 请求</span></span><br><span class="line">  <span class="type">int</span> httpCode = http.<span class="built_in">GET</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查返回码</span></span><br><span class="line">  <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">      String payload = http.<span class="built_in">getString</span>();</span><br><span class="line">      Serial.<span class="built_in">println</span>(payload);</span><br><span class="line">      <span class="function">DynamicJsonDocument <span class="title">doc</span><span class="params">(<span class="number">2048</span>)</span></span>;</span><br><span class="line">      DeserializationError error = <span class="built_in">deserializeJson</span>(doc, payload);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;JSON parse ok&quot;</span>);</span><br><span class="line">      <span class="type">const</span> <span class="type">char</span>* artist = doc[<span class="string">&quot;ar&quot;</span>];</span><br><span class="line">      <span class="type">const</span> <span class="type">char</span>* url = doc[<span class="string">&quot;url&quot;</span>];</span><br><span class="line">      <span class="type">const</span> <span class="type">char</span>* pic = doc[<span class="string">&quot;pic&quot;</span>];</span><br><span class="line">      <span class="type">const</span> <span class="type">char</span>* name = doc[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">      <span class="type">const</span> <span class="type">int</span> dt = doc[<span class="string">&quot;dt&quot;</span>];</span><br><span class="line">      <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">      lrcLen = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>(JsonObject lrc_line : doc[<span class="string">&quot;lrc&quot;</span>].<span class="built_in">as</span>&lt;JsonArray&gt;())&#123;</span><br><span class="line">        <span class="type">const</span> String text = lrc_line[<span class="string">&quot;lrc&quot;</span>];</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> lt = lrc_line[<span class="string">&quot;t&quot;</span>];</span><br><span class="line">        lrcs[i].lrc = text;</span><br><span class="line">        lrcs[i].t = lt;</span><br><span class="line">        i++;</span><br><span class="line">        lrcLen++;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">showJPEG</span>((String)pic,<span class="number">10</span>,<span class="number">10</span>);</span><br><span class="line">      SPIFFS.<span class="built_in">remove</span>(<span class="string">&quot;/image.jpg&quot;</span>);</span><br><span class="line">      audio.<span class="built_in">connecttohost</span>(url);</span><br><span class="line">      tft.<span class="built_in">setCursor</span>(<span class="number">10</span>,<span class="number">170</span>);</span><br><span class="line">      tft.<span class="built_in">println</span>((String)name+<span class="string">&quot;\n  &quot;</span>+(String)artist);</span><br><span class="line">      nowIndex = <span class="number">0</span>;</span><br><span class="line">      totalTime = dt;</span><br><span class="line">      sprite.<span class="built_in">fillScreen</span>(TFT_BLACK);</span><br><span class="line">      sprite.<span class="built_in">drawFastHLine</span>(<span class="number">10</span>,<span class="number">55</span>,<span class="number">220</span>,TFT_WHITE);</span><br><span class="line">      sprite.<span class="built_in">drawFastVLine</span>(<span class="number">10</span>,<span class="number">50</span>,<span class="number">10</span>,TFT_WHITE);</span><br><span class="line">      sprite.<span class="built_in">setCursor</span>(<span class="number">10</span>,<span class="number">70</span>);</span><br><span class="line">      sprite.<span class="built_in">print</span>(<span class="string">&quot;00:00&quot;</span>);</span><br><span class="line">      sprite.<span class="built_in">pushSprite</span>(<span class="number">0</span>,<span class="number">220</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;GET request failed, error: %s\n&quot;</span>, http.<span class="built_in">errorToString</span>(httpCode).<span class="built_in">c_str</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  http.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">showJPEG</span><span class="params">(String url,<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">  HTTPClient http;</span><br><span class="line">  http.<span class="built_in">begin</span>(url);</span><br><span class="line">  <span class="type">int</span> httpCode = http.<span class="built_in">GET</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">    File file = SPIFFS.<span class="built_in">open</span>(<span class="string">&quot;/image.jpg&quot;</span>, FILE_WRITE);</span><br><span class="line">    <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;Failed to open file for writing&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    WiFiClient* stream = http.<span class="built_in">getStreamPtr</span>();</span><br><span class="line">    <span class="type">uint8_t</span> buffer[<span class="number">128</span>];</span><br><span class="line">    <span class="type">int</span> len = http.<span class="built_in">getSize</span>();</span><br><span class="line">    <span class="keyword">while</span> (http.<span class="built_in">connected</span>() &amp;&amp; (len &gt; <span class="number">0</span> || len == <span class="number">-1</span>)) &#123;</span><br><span class="line">      <span class="type">size_t</span> size = stream-&gt;<span class="built_in">available</span>();</span><br><span class="line">      <span class="keyword">if</span> (size) &#123;</span><br><span class="line">        <span class="type">int</span> c = stream-&gt;<span class="built_in">readBytes</span>(buffer, ((size &gt; <span class="built_in">sizeof</span>(buffer)) ? <span class="built_in">sizeof</span>(buffer) : size));</span><br><span class="line">        file.<span class="built_in">write</span>(buffer, c);</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          len -= c;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;File downloaded and saved to SPIFFS&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;HTTP GET failed, error: %s\n&quot;</span>, http.<span class="built_in">errorToString</span>(httpCode).<span class="built_in">c_str</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  http.<span class="built_in">end</span>();</span><br><span class="line">  <span class="type">uint32_t</span> t = <span class="built_in">millis</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get the width and height in pixels of the jpeg if you wish</span></span><br><span class="line">  <span class="type">uint16_t</span> w = <span class="number">0</span>, h = <span class="number">0</span>;</span><br><span class="line">  TJpgDec.<span class="built_in">getFsJpgSize</span>(&amp;w, &amp;h, <span class="string">&quot;/image.jpg&quot;</span>); <span class="comment">// Note name preceded with &quot;/&quot;</span></span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;Width = &quot;</span>); Serial.<span class="built_in">print</span>(w); Serial.<span class="built_in">print</span>(<span class="string">&quot;, height = &quot;</span>); Serial.<span class="built_in">println</span>(h);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Draw the image, top left at 0,0</span></span><br><span class="line">  TJpgDec.<span class="built_in">drawFsJpg</span>(x,y, <span class="string">&quot;/image.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// How much time did rendering take (ESP8266 80MHz 271ms, 160MHz 157ms, ESP32 SPI 120ms, 8bit parallel 105ms</span></span><br><span class="line">  t = <span class="built_in">millis</span>() - t;</span><br><span class="line">  Serial.<span class="built_in">print</span>(t); Serial.<span class="built_in">println</span>(<span class="string">&quot; ms&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">tft_output</span><span class="params">(<span class="type">int16_t</span> x, <span class="type">int16_t</span> y, <span class="type">uint16_t</span> w, <span class="type">uint16_t</span> h, <span class="type">uint16_t</span>* bitmap)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// Stop further decoding as image is running off bottom of screen</span></span><br><span class="line">  <span class="keyword">if</span> ( y &gt;= tft.<span class="built_in">height</span>() ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This function will clip the image block rendering automatically at the TFT boundaries</span></span><br><span class="line">  tft.<span class="built_in">pushImage</span>(x, y, w, h, bitmap);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This might work instead if you adapt the sketch to use the Adafruit_GFX library</span></span><br><span class="line">  <span class="comment">// tft.drawRGBBitmap(x, y, bitmap, w, h);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Return 1 to decode next block</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">GetKey</span><span class="params">(<span class="type">int</span> pin)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">digitalRead</span>(pin) == LOW)&#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">digitalRead</span>(pin) == LOW)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">  audio.<span class="built_in">loop</span>();</span><br><span class="line">  <span class="type">int</span> t = audio.<span class="built_in">getAudioCurrentTime</span>();</span><br><span class="line">  <span class="keyword">if</span>(t &gt; totalTime<span class="number">-1</span>)&#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">4000</span>);</span><br><span class="line">    ESP.<span class="built_in">restart</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">GetKey</span>(pin_aud_up))&#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;audio up&quot;</span>);</span><br><span class="line">    audioVol++;</span><br><span class="line">    <span class="keyword">if</span>(audioVol &gt; <span class="number">21</span>)&#123;</span><br><span class="line">      audioVol = <span class="number">21</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    audio.<span class="built_in">setVolume</span>(audioVol);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">GetKey</span>(pin_aud_down))&#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;audio down&quot;</span>);</span><br><span class="line">    audioVol--;</span><br><span class="line">    <span class="keyword">if</span>(audioVol &lt; <span class="number">0</span>)&#123;</span><br><span class="line">      audioVol = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    audio.<span class="built_in">setVolume</span>(audioVol);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">GetKey</span>(pin_pause))&#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    audio.<span class="built_in">pauseResume</span>();</span><br><span class="line">    isPlaying = !isPlaying;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> minute = <span class="built_in">floor</span>(t / <span class="number">60</span>);</span><br><span class="line">  <span class="type">int</span> second = <span class="built_in">round</span>(t % <span class="number">60</span>);</span><br><span class="line">  String ms = minute &gt;= <span class="number">10</span> ? (String)minute : <span class="string">&quot;0&quot;</span>+(String)minute;</span><br><span class="line">  String ss = second &gt;= <span class="number">10</span> ? (String)second : <span class="string">&quot;0&quot;</span>+(String)second;</span><br><span class="line">  sprite.<span class="built_in">fillScreen</span>(TFT_BLACK);</span><br><span class="line">  sprite.<span class="built_in">drawFastHLine</span>(<span class="number">10</span>,<span class="number">55</span>,<span class="number">220</span>,TFT_WHITE);</span><br><span class="line">  sprite.<span class="built_in">drawFastVLine</span>(<span class="number">10</span><span class="number">+220.0</span>*((<span class="type">double</span>)t/totalTime),<span class="number">50</span>,<span class="number">10</span>,TFT_WHITE);</span><br><span class="line">  sprite.<span class="built_in">setCursor</span>(<span class="number">10</span>,<span class="number">70</span>);</span><br><span class="line">  sprite.<span class="built_in">print</span>(ms+<span class="string">&quot;:&quot;</span>+ss);</span><br><span class="line">  sprite.<span class="built_in">setCursor</span>(<span class="number">80</span>,<span class="number">70</span>);</span><br><span class="line">  sprite.<span class="built_in">print</span>(isPlaying ? <span class="string">&quot;| |&quot;</span> : <span class="string">&quot;▶&quot;</span>);</span><br><span class="line">  sprite.<span class="built_in">setCursor</span>(<span class="number">132</span>,<span class="number">70</span>);</span><br><span class="line">  sprite.<span class="built_in">print</span>(<span class="string">&quot;音量:&quot;</span>+(String)(((<span class="type">double</span>)audioVol/<span class="number">21</span>)*<span class="number">100</span>)+<span class="string">&quot;%&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(nowIndex &lt; lrcLen<span class="number">-1</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(t &gt;= lrcs[nowIndex].t)&#123;</span><br><span class="line">      nowIndex++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sprite.<span class="built_in">setCursor</span>(<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">  sprite.<span class="built_in">println</span>(lrcs[nowIndex].lrc);</span><br><span class="line">  sprite.<span class="built_in">pushSprite</span>(<span class="number">0</span>,<span class="number">220</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_info</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;info        &quot;</span>); Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_id3data</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;  <span class="comment">//id3 metadata</span></span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;id3data     &quot;</span>);Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_eof_mp3</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;  <span class="comment">//end of file</span></span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;eof_mp3     &quot;</span>);Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_showstation</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;station     &quot;</span>);Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_showstreamtitle</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;streamtitle &quot;</span>);Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_bitrate</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;bitrate     &quot;</span>);Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_commercial</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;  <span class="comment">//duration in sec</span></span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;commercial  &quot;</span>);Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_icyurl</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;  <span class="comment">//homepage</span></span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;icyurl      &quot;</span>);Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">audio_lasthost</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *info)</span></span>&#123;  <span class="comment">//stream URL played</span></span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;lasthost    &quot;</span>);Serial.<span class="built_in">println</span>(info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/08/03/esp8266%E9%A1%B9%E7%9B%AE%E6%8E%A5%E7%BA%BF%E8%AE%B0%E5%BD%95/" rel="prev" title="esp8266项目接线记录">
      <i class="fa fa-chevron-left"></i> esp8266项目接线记录
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/09/21/%E5%85%B3%E4%BA%8E%E7%8B%AC%E7%AB%8B%E6%B8%B8%E6%88%8F%E4%B9%8B%E5%90%8E%E7%9A%84%E8%AE%BE%E8%AE%A1/" rel="next" title="关于独立游戏之后的设计">
      关于独立游戏之后的设计 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ESP32-S3%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8"><span class="nav-number">1.</span> <span class="nav-text">ESP32-S3音乐播放器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%90%E6%96%99%E5%92%8C%E4%B8%89%E6%96%B9%E5%BA%93"><span class="nav-number">1.1.</span> <span class="nav-text">材料和三方库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E7%AE%80%E5%8D%95%E5%A4%84%E7%90%86"><span class="nav-number">1.2.</span> <span class="nav-text">后端简单处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A1%AC%E4%BB%B6%E7%AB%AF"><span class="nav-number">1.3.</span> <span class="nav-text">硬件端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.1.</span> <span class="nav-text">字体文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.3.2.</span> <span class="nav-text">程序</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Kevin-100717</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kevin-100717</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
